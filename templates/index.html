<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Blinkathon</title>
    <link href="/static/css/style.css" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"
      integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA=="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="bg-orange-400 p-5">
      <header>
        <h1 class="text-4xl">Blinkathon</h1>
        <p>This is a super cool game.</p>
      </header>
      <div
        id="game-console"
        class="my-10 flex flex-col justify-center items-center"
      >
        <p id="game-status">Press a button to start.</p>
        <button
          id="start-btn"
          class="btn-primary mt-2 text-black disabled:text-gray-400"
          disabled="true"
          onclick="startGame()"
        >
          Start
        </button>
      </div>
      <div class="flex justify-between">
        <p>Player 1<br/><span id="player1-blink-count">0</span> counts</p>
        <p class="text-right">Player 2<br/><span id="player2-blink-count">0</span> counts</p>
      </div>
      <div class="max-w-[400px] mx-auto bg-slate-200 border border-slate-400 rounded-lg">
        <img
          id="live-camera"
          alt="Live Camera"
          class="w-full h-full object-cover rounded-lg"
        />
      </div>
    </div>
    <footer>
      <p class="text-center text-sm px-5 py-2">
        <a href="/about" class="btn-primary"
          >Blinkathon by Computer Vision Syndrome</a
        >
      </p>
    </footer>
    <script type="text/javascript" charset="utf-8">
      var videoPlayer = document.getElementById('live-camera');
      videoPlayer.src = '/video-feed';
    </script>
    <script type="text/javascript" charset="utf-8">
      var socket = io();
      socket.on('connect', function () {
        console.log('connected!');
      });

      setInterval(() => {
        socket.emit('blinkathon-status');
      }, 1000);

      socket.on('game', function (game) {
        console.log('game:', game);
        const startBtn = document.getElementById('start-btn');
        if (!!game.playable) {
          startBtn.disabled = false;
        } else {
          startBtn.disabled = true;
        }
        const gameStatus = document.getElementById('game-status');
        if (!!game.detecting) {
          gameStatus.innerText = "Blink!"
        }

        const player1BlinkCount = document.getElementById('player1-blink-count')
        player1BlinkCount.innerText = game.players[0].blinkCount
        const player2BlinkCount = document.getElementById('player2-blink-count')
        player2BlinkCount.innerText = game.players[1].blinkCount
      });

      const startGame = () => {
        const startBtn = document.getElementById('start-btn');
        startBtn.style.display = "none"
        socket.emit('start-game');
        const gameStatus = document.getElementById('game-status');
        gameStatus.innerText = "Calculating... - Please keep your eyes open."
      };

      window.onbeforeunload = function () {
        socket.emit('exit', { msg: 'Bye!' });
      };
    </script>
  </body>
</html>
